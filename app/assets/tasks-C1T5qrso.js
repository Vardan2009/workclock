import{a as i}from"./api-LW24cLYi.js";import{B as u}from"./index-DhGHPcRP.js";class c{constructor(t,n,s,r){this.taskId=t,this.estDurationSec=n,this.realDurationSec=s,this.timestampStarted=r}getTimeBias(){return this.realDurationSec-this.estDurationSec}}class o{constructor(t,n,s,r){this.id=t,this.title=n,this.icon=s||"ðŸ“",this.taskInstances=[],this.notes=r,this.currentRunningInstance=void 0}getAvgEstTime(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((n,s)=>n+s.estDurationSec,0)/this.taskInstances.length}getAvgRealTime(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((n,s)=>n+s.realDurationSec,0)/this.taskInstances.length}getAvgTimeBias(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((n,s)=>n+s.getTimeBias(),0)/this.taskInstances.length}getAvgTimeBiasPercentage(){const t=this.getAvgEstTime();if(t===void 0||t===0)return;const n=this.getAvgTimeBias();if(n!==void 0)return n/t*100}startNewInstance(t){const n=new c(this.id,t,0,Date.now());this.currentRunningInstance=n}getCurrentRunningInstanceElapsedTime(){if(this.currentRunningInstance){const t=Date.now();return Math.floor((t-this.currentRunningInstance.timestampStarted)/1e3)}return 0}async stopCurrentInstance(){if(this.currentRunningInstance){const t=Date.now(),n=Math.floor((t-this.currentRunningInstance.timestampStarted)/1e3);this.currentRunningInstance.realDurationSec=n,await i(`/tasks/${this.id}/instances`,{method:"POST",body:JSON.stringify({est_duration_sec:this.currentRunningInstance.estDurationSec,real_duration_sec:n,timestamp_started:this.currentRunningInstance.timestampStarted})}),this.taskInstances.push(this.currentRunningInstance),this.currentRunningInstance=void 0}}}const a=u({tasks:[]});async function l(){try{const e=await i("/tasks");a.tasks=e.tasks.map(t=>new o(t.id,t.title,t.icon,t.task_note)),a.tasks.forEach(t=>{const n=e.tasks.find(s=>s.id===t.id);n&&(t.taskInstances=n.task_instances.map(s=>new c(s.taskId,s.est_duration_sec,s.real_duration_sec,s.timestamp_started)))})}catch(e){console.error("Failed to load tasks:",e)}}async function k(e,t){try{const n=await i("/tasks",{method:"POST",body:JSON.stringify({title:e,icon:t||"ðŸ“"})});a.tasks.push(new o(n.id,n.title,n.icon))}catch(n){console.error("Failed to add task:",n)}}async function g(e){try{await i(`/tasks/${e}`,{method:"DELETE"}),a.tasks=a.tasks.filter(t=>t.id!==e)}catch(t){console.error("Failed to remove task:",t)}}async function m(e,t){try{await i(`/tasks/${e}/note`,{method:"PATCH",body:JSON.stringify({note:t})}),a.tasks.find(n=>n.id===e).notes=t}catch(n){console.error("Failed to update task note:",n)}}export{o as Task,c as TaskInstance,k as addTask,l as loadTasks,g as removeTask,a as store,m as updateTaskNote};
