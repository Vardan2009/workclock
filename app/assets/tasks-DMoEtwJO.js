import{a as i}from"./api-Bys2i4Lb.js";import{z as u}from"./index-C0cmvDAF.js";class r{constructor(t,s,n,o){this.taskId=t,this.estDurationSec=s,this.realDurationSec=n,this.timestampStarted=o}getTimeBias(){return this.realDurationSec-this.estDurationSec}}class c{constructor(t,s,n){this.id=t,this.title=s,this.icon=n||"ðŸ“",this.taskInstances=[],this.currentRunningInstance=void 0}getAvgEstTime(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((s,n)=>s+n.estDurationSec,0)/this.taskInstances.length}getAvgRealTime(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((s,n)=>s+n.realDurationSec,0)/this.taskInstances.length}getAvgTimeBias(){return this.taskInstances.length===0?void 0:this.taskInstances.reduce((s,n)=>s+n.getTimeBias(),0)/this.taskInstances.length}getAvgTimeBiasPercentage(){const t=this.getAvgEstTime();if(t===void 0||t===0)return;const s=this.getAvgTimeBias();if(s!==void 0)return s/t*100}startNewInstance(t){const s=new r(this.id,t,0,Date.now());this.currentRunningInstance=s}getCurrentRunningInstanceElapsedTime(){if(this.currentRunningInstance){const t=Date.now();return Math.floor((t-this.currentRunningInstance.timestampStarted)/1e3)}return 0}async stopCurrentInstance(){if(this.currentRunningInstance){const t=Date.now(),s=Math.floor((t-this.currentRunningInstance.timestampStarted)/1e3);this.currentRunningInstance.realDurationSec=s,await i(`/tasks/${this.id}/instances`,{method:"POST",body:JSON.stringify({est_duration_sec:this.currentRunningInstance.estDurationSec,real_duration_sec:s,timestamp_started:this.currentRunningInstance.timestampStarted})}),this.taskInstances.push(this.currentRunningInstance),this.currentRunningInstance=void 0}}}const a=u({tasks:[]});async function l(){try{const e=await i("/tasks");a.tasks=e.tasks.map(t=>new c(t.id,t.title,t.icon)),a.tasks.forEach(t=>{const s=e.tasks.find(n=>n.id===t.id);s&&(t.taskInstances=s.task_instances.map(n=>new r(n.taskId,n.est_duration_sec,n.real_duration_sec,n.timestamp_started)))})}catch(e){console.error("Failed to load tasks:",e)}}async function g(e,t){try{const s=await i("/tasks",{method:"POST",body:JSON.stringify({title:e,icon:t||"ðŸ“"})});a.tasks.push(new c(s.id,s.title,s.icon))}catch(s){console.error("Failed to add task:",s)}}async function k(e){try{await i(`/tasks/${e}`,{method:"DELETE"}),a.tasks=a.tasks.filter(t=>t.id!==e)}catch(t){console.error("Failed to remove task:",t)}}export{g as a,l,k as r,a as s};
